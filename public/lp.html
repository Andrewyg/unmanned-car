<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script>
    Array.prototype.getRand = function () {
        return this[Math.floor(Math.random() * this.length)]
    }
    function randNum(min, max) {
        return Math.random() * (max - min) + min;
    }
    var keys = ["bottom", "right", "top", "left"];
    var dirs = ["left", "straight", "right"];
    function getUrlVars() {
        var vars = [], hash;
        var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
        for (var i = 0; i < hashes.length; i++) {
            hash = hashes[i].split('=');
            vars.push(hash[0]);
            vars[hash[0]] = hash[1];
        }
        return vars;
    }
    var query = getUrlVars();
    var queryFull = window.location.href.slice(window.location.href.indexOf('?') + 1);
    function addCar(dest) {
        $.post("/api/add", { place: keys.getRand(), direction: dirs.getRand() }, (data) => {
            if (dest > 0) return addCar(dest - 1);
        })
    }
    var results = [];
    function operate(dest) {
        addCar(randNum(query.carMin, query.carMax));
        $.get('/api/operate/current?' + queryFull, (data) => {
            results.push(data);
            if (dest > 0) return operate(dest - 1);
        })
    }
    operate(query.dataAmount);
    var original = [];
    var compare = [];
    // for (i = 0; i < results.length; i++) {
    function getOtherData(dest) {
        $.get("/api/db/scene/" + results[dest].refCIns, (data) => {
            original.push(data);
            $.get("/api/db/compare/" + results[dest].refCompare, (data2) => {
                compare.push(data2);
                if (dest < results.length) return getOtherData(dest + 1);
            })
        })
    }
    getOtherData(0);
    for (i = 0; i < results.length; i++) {
        $('body').append("<table><tr><td>left</td><td>straight</td><td>right</td></tr>");
        for (j = 0; j < 4; j++) {
            $('body').append("<tr>");
            for (k = 0; k < 3; k++) {
                $('body').append("<td>" + original[i][j][k].amount + "</td>");
            }
            $('body').append("</tr>");
        }
        $('body').append("<tr><td>Normal</td><td colspan='2'>" + compare[i].normalInsTakenTime + "sec</td></tr>");
        $('body').append("<tr><td>CCIns</td><td colspan='2'>" + compare[i].computerControledInsTakenTime + "sec</td></tr>");
        $('body').append("</table><hr />");
    }
</script>