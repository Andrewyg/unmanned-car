<style>
    table,
    td,
    th {
        border: 1px solid #ddd;
        text-align: left;
    }

    table {
        border-collapse: collapse;
        width: 100%;
    }

    th,
    td {
        padding: 15px;
    }
</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script>
    Array.prototype.getRand = function () {
        return this[Math.floor(Math.random() * this.length)]
    }
    function randNum(min, max) {
        return Math.random() * (max - min) + min;
    }
    var keys = ["bottom", "right", "top", "left"];
    var dirs = ["left", "straight", "right"];
    var wholeHTML = "";
    function getUrlVars() {
        var vars = [], hash;
        var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
        for (var i = 0; i < hashes.length; i++) {
            hash = hashes[i].split('=');
            vars.push(hash[0]);
            vars[hash[0]] = hash[1];
        }
        return vars;
    }
    var query = getUrlVars();
    var queryFull = window.location.href.slice(window.location.href.indexOf('?') + 1);
    function addCar(dest) {
        $.post("/api/add", { place: keys.getRand(), direction: dirs.getRand() }, (data) => {
            if (dest > 0) return addCar(dest - 1);
        })
    }
    var results = [];
    function operate(dest) {
        addCar(randNum(query.carMin, query.carMax));
        $.get('/api/operate/current?' + queryFull, (data) => {
            results.push(data.output);
            if (dest > 0) return operate(dest - 1); else getOtherData(0);
        })
    }
    operate(query.dataAmount - 1);
    var original = [];
    var compare = [];
    // for (i = 0; i < results.length; i++) {
    function getOtherData(dest) {
        $.get("/api/db/scene/" + results[dest].refCIns, (data) => {
            original.push(data);
            $.get("/api/db/compare/" + results[dest].refCompare, (data2) => {
                compare.push(data2);
                if (dest < results.length - 1) return getOtherData(dest + 1); else return createTable();
            })
        })
    }
    function createTable() {
        for (i = 0; i < results.length; i++) {
            wholeHTML += "<table><tr><td>&nbsp;</td><td>left</td><td>straight</td><td>right</td></tr>";
            for (j = 0; j < keys.length; j++) {
                wholeHTML += "<tr><td>" + keys[j] + "</td>";
                for (k = 0; k < dirs.length; k++) {
                    wholeHTML += "<td>" + original[i][keys[j]][dirs[k]].amount + "</td>";
                }
                wholeHTML += "</tr>";
            }
            wholeHTML += "<tr><td colspan='2'>Normal</td><td colspan='2'>" + compare[i].normalInsTakenTime + "sec</td></tr>";
            wholeHTML += "<tr><td colspan='2'>CCIns</td><td colspan='2'>" + compare[i].computerControledInsTakenTime + "sec</td></tr>";
            wholeHTML += "</table><hr />";
        }
        $('body').html(wholeHTML);
    }
</script>